"use strict";(self.webpackChunkreact_native_reanimated_docs=self.webpackChunkreact_native_reanimated_docs||[]).push([[59],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=i,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return n?a.createElement(h,o(o({ref:t},d),{},{components:n})):a.createElement(h,o({ref:t},d))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},47293:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(83117),i=(n(67294),n(3905));const r={id:"Troubleshooting",title:"Troubleshooting",sidebar_label:"Troubleshooting"},o="Troubleshooting",l={unversionedId:"guides/Troubleshooting",id:"guides/Troubleshooting",title:"Troubleshooting",description:"Initialization issues",source:"@site/docs/guides/troubleshooting.mdx",sourceDirName:"guides",slug:"/guides/Troubleshooting",permalink:"/react-native-reanimated/docs/guides/Troubleshooting",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/guides/troubleshooting.mdx",tags:[],version:"current",frontMatter:{id:"Troubleshooting",title:"Troubleshooting",sidebar_label:"Troubleshooting"},sidebar:"tutorialSidebar",previous:{title:"Testing with Jest",permalink:"/react-native-reanimated/docs/guides/testing"},next:{title:"Web Support",permalink:"/react-native-reanimated/docs/guides/web-support"}},s={},p=[{value:"Initialization issues",id:"initialization-issues",level:2},{value:"Failed to create a worklet",id:"failed-to-create-a-worklet",level:3},{value:"Native part of Reanimated doesn&#39;t seem to be initialized",id:"native-part-of-reanimated-doesnt-seem-to-be-initialized",level:3},{value:"Unknown version of Reanimated Babel plugin",id:"unknown-version-of-reanimated-babel-plugin",level:3},{value:"Mismatch between JavaScript code version and Reanimated Babel plugin version",id:"mismatch-between-javascript-code-version-and-reanimated-babel-plugin-version",level:3},{value:"Using dev bundle in a release app build is not supported",id:"using-dev-bundle-in-a-release-app-build-is-not-supported",level:3},{value:"Couldn&#39;t determine the version of the native part of Reanimated",id:"couldnt-determine-the-version-of-the-native-part-of-reanimated",level:3},{value:"Mismatch between JavaScript part and native part of Reanimated",id:"mismatch-between-javascript-part-and-native-part-of-reanimated",level:3},{value:"Multiple versions of Reanimated were detected",id:"multiple-versions-of-reanimated-were-detected",level:3},{value:"Outdated version of React Native for New Architecture",id:"outdated-version-of-react-native-for-new-architecture",level:3},{value:"Threading issues",id:"threading-issues",level:2},{value:"Tried to synchronously call a non-worklet function on the UI thread",id:"tried-to-synchronously-call-a-non-worklet-function-on-the-ui-thread",level:3}],d={toc:p},u="wrapper";function c(e){let{components:t,...n}=e;return(0,i.kt)(u,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("h2",{id:"initialization-issues"},"Initialization issues"),(0,i.kt)("p",null,"Reanimated has four core components that compose its code:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"C++,"),(0,i.kt)("li",{parentName:"ul"},"Java,"),(0,i.kt)("li",{parentName:"ul"},"JavaScript,"),(0,i.kt)("li",{parentName:"ul"},"Reanimated Babel plugin.")),(0,i.kt)("p",null,"All of them are supposed to work correctly only within the same minor version. Therefore, having any of those pieces in your code - directly or indirectly - separate from ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-reanimated"),", especially having any code transpiled with a different version of the aforementioned plugin will result in undefined behavior and errors."),(0,i.kt)("h3",{id:"failed-to-create-a-worklet"},"Failed to create a worklet"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This usually happens when Reanimated is not properly installed, e.g. forgetting to include the Reanimated Babel plugin in ",(0,i.kt)("inlineCode",{parentName:"p"},"babel.config.js"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," See installation docs at ",(0,i.kt)("a",{parentName:"p",href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation#babel-plugin"},"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/installation#babel-plugin")," for more information."),(0,i.kt)("h3",{id:"native-part-of-reanimated-doesnt-seem-to-be-initialized"},"Native part of Reanimated doesn't seem to be initialized"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This issue happens when Reanimated fails to initialize its native side from JavaScript."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If you recently installed or upgraded Reanimated, make sure to rebuild your app."),(0,i.kt)("li",{parentName:"ol"},"Check if your platform is supported by Reanimated. Currently we support:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Android"),(0,i.kt)("li",{parentName:"ul"},"iOS"),(0,i.kt)("li",{parentName:"ul"},"macOS"),(0,i.kt)("li",{parentName:"ul"},"Web"))),(0,i.kt)("li",{parentName:"ol"},"If you are using Reanimated in a brownfield app, make sure to initialize the native library manually.")),(0,i.kt)("h3",{id:"unknown-version-of-reanimated-babel-plugin"},"Unknown version of Reanimated Babel plugin"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This happens when JavaScript side of Reanimated fails to get Reanimated Babel plugin version."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Part of your code might be transpiled with an outdated version of Reanimated Babel plugin. See ",(0,i.kt)("a",{parentName:"li",href:"https://docs.swmansion.com/react-native-reanimated/docs/guides/Troubleshooting#mismatch-between-javascript-code-version-and-reanimated-babel-plugin-version"},"Mismatch between JavaScript code version and Reanimated Babel plugin version"),"."),(0,i.kt)("li",{parentName:"ol"},"You use release bundle with debug build of the app. This is not supported. See ",(0,i.kt)("a",{parentName:"li",href:"https://docs.swmansion.com/react-native-reanimated/docs/guides/Troubleshooting#using-dev-bundle-in-a-release-app-build-is-not-supported"},"Using dev bundle in release app build is not supported")," for more information.")),(0,i.kt)("h3",{id:"mismatch-between-javascript-code-version-and-reanimated-babel-plugin-version"},"Mismatch between JavaScript code version and Reanimated Babel plugin version"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This can happen when you use code that was transpiled with an outdated version of Reanimated Babel plugin."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," Try resetting your Metro bundler cache with ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn start --reset-cache"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"npm start -- --reset-cache")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"expo start -c")," and run the app again."),(0,i.kt)("p",null,"If this didn't help, you probably have a dependency that contains already transformed worklets bundled with an outdated version of the Reanimated Babel plugin. You can find the offending code that was given alongside the error to find that dependency."),(0,i.kt)("h3",{id:"using-dev-bundle-in-a-release-app-build-is-not-supported"},"Using dev bundle in a release app build is not supported"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This happens when you use a release build of your app with a development JavaScript bundle."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," See this ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/software-mansion/react-native-reanimated/issues/4737"},"post")," for more information."),(0,i.kt)("h3",{id:"couldnt-determine-the-version-of-the-native-part-of-reanimated"},"Couldn't determine the version of the native part of Reanimated"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This happens when Reanimated fails to determine the version of its native part."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," Check if you have rebuilt your app after upgrading ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-reanimated"),". If you use Expo Go, you must use the exact version which is bundled into Expo SDK."),(0,i.kt)("h3",{id:"mismatch-between-javascript-part-and-native-part-of-reanimated"},"Mismatch between JavaScript part and native part of Reanimated"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This happens when Reanimated has different versions of its JavaScript and native parts."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," Check if you have rebuilt your app after upgrading ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-reanimated"),". If you use Expo Go, you must use the exact version which is bundled into Expo SDK."),(0,i.kt)("h3",{id:"multiple-versions-of-reanimated-were-detected"},"Multiple versions of Reanimated were detected"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This error usually happens when in your project exists more than one instance of Reanimated. It can occur when some of your dependency has installed Reanimated inside their own ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," instead of using it as a peer dependency. In this case two different versions of Reanimated JavaScript module might try to initialize its native part. You can check which libraries are using Reanimated e.g. with ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn why react-native-reanimated")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"npm ls react-native-reanimated"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," Modify your ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," file accordingly:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"if you use ",(0,i.kt)("inlineCode",{parentName:"li"},"yarn"),", you should add ",(0,i.kt)("a",{parentName:"li",href:"https://classic.yarnpkg.com/lang/en/docs/selective-version-resolutions/"},(0,i.kt)("inlineCode",{parentName:"a"},"resolution")," property"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"resolutions": {\n  "react-native-reanimated": <Reanimated version>\n}\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"if you use ",(0,i.kt)("inlineCode",{parentName:"li"},"npm"),", you should add ",(0,i.kt)("a",{parentName:"li",href:"https://docs.npmjs.com/cli/v7/configuring-npm/package-json#overrides"},(0,i.kt)("inlineCode",{parentName:"a"},"overrides")," property"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'"overrides": {\n  "react-native-reanimated": <Reanimated version>\n}\n')),(0,i.kt)("p",null,"After that make sure to run your package manager again, either ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install"),"."),(0,i.kt)("h3",{id:"outdated-version-of-react-native-for-new-architecture"},"Outdated version of React Native for New Architecture"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," Reanimated supports New Architecture (Fabric) only on the latest minor release of React Native."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")," Please upgrade to at least React Native 0.72 or downgrade to an older version of Reanimated 3."),(0,i.kt)("h2",{id:"threading-issues"},"Threading issues"),(0,i.kt)("h3",{id:"tried-to-synchronously-call-a-non-worklet-function-on-the-ui-thread"},"Tried to synchronously call a non-worklet function on the UI thread"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Problem:")," This can happen when you try to call a function that is not marked as a worklet from a worklet. E.g.:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"function callee() {\n  console.log('hello');\n}\nfunction caller() {\n  'worklet';\n  callee(); // <- this will throw in `runOnUI`\n}\nrunOnUI(caller)();\n")),(0,i.kt)("p",null,"In this example, ",(0,i.kt)("inlineCode",{parentName:"p"},"callee")," cannot be called from a worklet ran on UI thread because there is no corresponding UI function for ",(0,i.kt)("inlineCode",{parentName:"p"},"callee"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Solution:")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If you want to synchronously execute this method, mark it as a worklet using ",(0,i.kt)("inlineCode",{parentName:"li"},"worklet")," directive:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"}," function callee() {\n+  'worklet';\n   console.log(\"hello\");\n }\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"If you want to execute this function on the JS thread, wrap it using ",(0,i.kt)("inlineCode",{parentName:"li"},"runOnJS"),":")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"}," function caller() {\n   'worklet';\n-  callee();\n+  runOnJS(callee)();\n }\n")),(0,i.kt)("p",null,"Check ",(0,i.kt)("a",{parentName:"p",href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#worklet"},"this page")," to learn more about Reanimated and its worklets."))}c.isMDXComponent=!0}}]);