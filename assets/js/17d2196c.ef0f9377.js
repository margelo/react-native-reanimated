"use strict";(self.webpackChunkreact_native_reanimated_docs=self.webpackChunkreact_native_reanimated_docs||[]).push([[8533],{46785:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>T,contentTitle:()=>N,default:()=>D,frontMatter:()=>w,metadata:()=>x,toc:()=>_});var a=n(83117),i=n(67294),r=n(3905),o=n(67177),s=n(24404),l=n(72400),u=n(28033),d=n(82334),c=n(10758),m=n(10919),p=n(72510),h=n(38404),v=n(12717),f=n(49638);const g={code:"function anonymous(){const{width}=this.__closure;return width.value;}"},k={code:"function anonymous(){const{measure,animatedRef,runOnJS,setText}=this.__closure;const measurement=measure(animatedRef);if(measurement!==null){const measuredWidth=parseInt(measurement.width,10);runOnJS(setText)(measuredWidth);}}"};function y(){const e=(0,d.m)(),t=(0,c.y)(100),[n,a]=i.useState(t.value);return(0,p.J)(function(){const e=()=>t.value;return e.__closure={width:t},e.__initData=g,e.__workletHash=8144979773625,e}(),function(){const t=function(){const t=(0,h.L8)(e);if(null!==t){const e=parseInt(t.width,10);(0,v.tC)(a)(e)}};return t.__closure={measure:h.L8,animatedRef:e,runOnJS:v.tC,setText:a},t.__initData=k,t.__workletHash=1904413803809,t}()),i.createElement(o.Z,{style:b.container},i.createElement(f.n,{ref:e,style:{...b.box,width:t}}),i.createElement(s.Z,{style:b.label},"width: ",n),i.createElement(l.Z,{onPress:()=>{t.value=(0,m.V)(t.value+50)},title:"Click me"}))}const b=u.Z.create({container:{flex:1,alignItems:"center"},box:{height:100,backgroundColor:"#b58df1",borderRadius:20},label:{fontSize:24,marginVertical:16,color:"#b58df1"}}),R="import React from 'react';\nimport { Button, StyleSheet, View, Text } from 'react-native';\nimport Animated, {\n  measure,\n  runOnJS,\n  useAnimatedReaction,\n  useAnimatedRef,\n  useSharedValue,\n  withSpring,\n} from 'react-native-reanimated';\n\nexport default function App() {\n  const animatedRef = useAnimatedRef();\n  const width = useSharedValue(100);\n  const [text, setText] = React.useState(width.value);\n\n  const handlePress = () => {\n    width.value = withSpring(width.value + 50);\n  };\n\n  // highlight-start\n  useAnimatedReaction(\n    () => width.value,\n    () => {\n      const measurement = measure(animatedRef);\n\n      if (measurement !== null) {\n        const measuredWidth = parseInt(measurement.width, 10);\n        runOnJS(setText)(measuredWidth);\n      }\n    }\n  );\n  // highlight-end\n\n  return (\n    <View style={styles.container}>\n      <Animated.View ref={animatedRef} style={{ ...styles.box, width }} />\n      <Text style={styles.label}>width: {text}</Text>\n      <Button onPress={handlePress} title=\"Click me\" />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n  },\n  box: {\n    height: 100,\n    backgroundColor: '#b58df1',\n    borderRadius: 20,\n  },\n  label: {\n    fontSize: 24,\n    marginVertical: 16,\n    color: '#b58df1',\n  },\n});\n",w={sidebar_position:2},N="useAnimatedReaction",x={unversionedId:"advanced/useAnimatedReaction",id:"advanced/useAnimatedReaction",title:"useAnimatedReaction",description:"useAnimatedReaction allows you to respond to changes in a shared value. It's especially useful when comparing values previously stored in the shared value with the current one.",source:"@site/docs/advanced/useAnimatedReaction.mdx",sourceDirName:"advanced",slug:"/advanced/useAnimatedReaction",permalink:"/react-native-reanimated/docs/advanced/useAnimatedReaction",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/advanced/useAnimatedReaction.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"measure",permalink:"/react-native-reanimated/docs/advanced/measure"},next:{title:"useFrameCallback",permalink:"/react-native-reanimated/docs/advanced/useFrameCallback"}},T={},_=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>prepare</code>",id:"prepare",level:4},{value:"<code>react</code>",id:"react",level:4},{value:"<code>dependencies</code> <Optional/>",id:"dependencies-",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],C=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},A=C("Optional"),I=C("InteractiveExample"),S=C("Indent"),V={toc:_},P="wrapper";function D(e){let{components:t,...n}=e;return(0,r.kt)(P,(0,a.Z)({},V,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"useanimatedreaction"},"useAnimatedReaction"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useAnimatedReaction")," allows you to respond to changes in a ",(0,r.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#shared-value"},"shared value"),". It's especially useful when comparing values previously stored in the shared value with the current one."),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { useAnimatedReaction } from 'react-native-reanimated';\n\nfunction App() {\n  useAnimatedReaction(\n    () => {\n      return sv.value;\n    },\n    (currentValue, previousValue) => {\n      if (currentValue !== previousValue) {\n        // do something \u2728\n      }\n    }\n  );\n\n  // ...\n}\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Type definitions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"type DependencyList = ReadonlyArray<any>;\n\nfunction useAnimatedReaction<T>(\n  prepare: () => T,\n  react: (prepareResult: T, preparePreviousResult: T | null) => void,\n  dependencies?: DependencyList\n): void;\n"))),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("h4",{id:"prepare"},(0,r.kt)("inlineCode",{parentName:"h4"},"prepare")),(0,r.kt)("p",null,"A function that should return a value to which you'd like to react. The value returned from this function is used as the first parameter of the ",(0,r.kt)("inlineCode",{parentName:"p"},"react")," argument."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"function App() {\n  useAnimatedReaction(\n    // highlight-start\n    () => {\n      return Math.floor(sv.value);\n    },\n    // highlight-end\n    (currentValue, previousValue) => {\n      // ...\n    }\n  );\n}\n")),(0,r.kt)("h4",{id:"react"},(0,r.kt)("inlineCode",{parentName:"h4"},"react")),(0,r.kt)("p",null,"A function that reacts to changes in the value returned by the ",(0,r.kt)("inlineCode",{parentName:"p"},"prepare")," function. The ",(0,r.kt)("inlineCode",{parentName:"p"},"react")," function has two parameters: the current value from the ",(0,r.kt)("inlineCode",{parentName:"p"},"prepare")," function and the previous value, which is initially set to ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"function App() {\n  useAnimatedReaction(\n    () => {\n      return Math.floor(sv.value);\n    },\n    // highlight-next-line\n    (currentValue, previousValue) => {\n      // ...\n      // highlight-next-line\n    }\n  );\n}\n")),(0,r.kt)("h4",{id:"dependencies-"},(0,r.kt)("inlineCode",{parentName:"h4"},"dependencies")," ",(0,r.kt)(A,{mdxType:"Optional"})),(0,r.kt)("p",null,"An optional array of dependencies."),(0,r.kt)("p",null,"Only relevant when using Reanimated ",(0,r.kt)("a",{parentName:"p",href:"https://docs.swmansion.com/react-native-reanimated/docs/guides/web-support#web-without-the-babel-plugin"},"without the Babel plugin on the Web"),"."),(0,r.kt)("h3",{id:"returns"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useAnimatedReaction")," returns ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined"),"."),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)(I,{src:R,component:(0,r.kt)(y,{mdxType:"AnimatedReactionMeasure"}),mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"remarks"},"Remarks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ensure you do not mutate the same shared value in the ",(0,r.kt)("inlineCode",{parentName:"li"},"result")," function that you've used in the ",(0,r.kt)("inlineCode",{parentName:"li"},"prepare")," function, as this will lead to an infinite loop.")),(0,r.kt)(S,{mdxType:"Indent"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx"},"function App() {\n  useAnimatedReaction(\n    () => {\n      // highlight-next-line\n      return width.value;\n    },\n    (currentValue) => {\n      // \ud83d\udea8 An infinite loop!\n      // highlight-next-line\n      width.value += currentValue;\n    }\n  );\n}\n"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Callbacks passed to the ",(0,r.kt)("inlineCode",{parentName:"p"},"prepare")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"result")," arguments are automatically ",(0,r.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#to-workletize"},"workletized")," and run on the ",(0,r.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You can technically react to any stateful React value using ",(0,r.kt)("inlineCode",{parentName:"p"},"useAnimatedReaction")," but you should probably use a ",(0,r.kt)("inlineCode",{parentName:"p"},"useEffect")," for that instead."))),(0,r.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.kt)("div",{className:"compatibility"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Android"),(0,r.kt)("th",{parentName:"tr",align:null},"iOS"),(0,r.kt)("th",{parentName:"tr",align:null},"Web"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2705"))))))}D.isMDXComponent=!0},10919:(e,t,n)=>{n.d(t,{V:()=>r});var a=n(76933);function i(e,t,n){if(t.configIsInvalid)return 0;const{stiffness:a,dampingRatio:i,restSpeedThreshold:r,duration:o}=t;return function(e){let{min:t,max:n,func:a,maxIterations:i=20}=e,r=i,o=(n+t)/2;for(;Math.abs(a(o))>5e-5&&r>0;)r-=1,a(o)<0?t=o:n=o,o=(t+n)/2;return o}({min:0,max:100,func:t=>{const s=(t*n*n+a*e*e)/(Math.exp(1-.5*i)*a);return-2*t/(2*i*Math.sqrt(a*t))*1e3*Math.log(.01*r/s)-o}})}const r=(e,t,n)=>(0,a.oF)(e,(()=>{const r={...{damping:10,mass:1,stiffness:100,overshootClamping:!1,restDisplacementThreshold:.01,restSpeedThreshold:2,velocity:0,duration:2e3,dampingRatio:.5,reduceMotion:void 0},...t,useDuration:!!(null!=t&&t.duration||null!=t&&t.dampingRatio),configIsInvalid:!1};return([r.stiffness,r.damping,r.duration,r.dampingRatio,r.restDisplacementThreshold,r.restSpeedThreshold].some((e=>e<=0))||0===r.mass)&&(r.configIsInvalid=!0,console.warn("You have provided invalid spring animation configuration! \n Value of stiffness, damping, duration and damping ratio must be greater than zero, and mass can't equal zero.")),{onFrame:function(e,t){const{toValue:n,startTimestamp:a,current:i}=e,o=t-a;if(r.useDuration&&o>=r.duration)return e.current=n,e.lastTimestamp=0,!0;if(r.configIsInvalid)return!r.useDuration&&(e.current=n,e.lastTimestamp=0,!0);const{lastTimestamp:s,velocity:l}=e,u=Math.min(t-s,64);e.lastTimestamp=t;const d=u/1e3,c=-l,m=n-i,{zeta:p,omega0:h,omega1:v}=e,{position:f,velocity:g}=p<1?function(e,t){const{toValue:n,current:a,velocity:i}=e,{zeta:r,t:o,omega0:s,omega1:l}=t,u=-i,d=n-a,c=Math.sin(l*o),m=Math.cos(l*o),p=Math.exp(-r*s*o),h=p*(c*((u+r*s*d)/l)+d*m);return{position:n-h,velocity:r*s*h-p*(m*(u+r*s*d)-l*d*c)}}(e,{zeta:p,v0:c,x0:m,omega0:h,omega1:v,t:d}):function(e,t){const{toValue:n}=e,{v0:a,x0:i,omega0:r,t:o}=t,s=Math.exp(-r*o);return{position:n-s*(i+(a+r*i)*o),velocity:s*(a*(o*r-1)+o*i*r*r)}}(e,{v0:c,x0:m,omega0:h,t:d});e.current=f,e.velocity=g;const{isOvershooting:k,isVelocity:y,isDisplacement:b}=function(e,t){const{toValue:n,velocity:a,startValue:i,current:r}=e;return{isOvershooting:!!t.overshootClamping&&(r>n&&i<n||r<n&&i>n),isVelocity:Math.abs(a)<t.restSpeedThreshold,isDisplacement:Math.abs(n-r)<t.restDisplacementThreshold}}(e,r),R=k||y&&b;return!(r.useDuration||!R)&&(e.velocity=0,e.current=n,e.lastTimestamp=0,!0)},onStart:function(e,t,n,a){e.current=t,e.startValue=t;let o=r.mass;const s=function(e,t){return(null==e?void 0:e.lastTimestamp)&&(null==e?void 0:e.startTimestamp)&&(null==e?void 0:e.toValue)===t.toValue&&(null==e?void 0:e.duration)===t.duration&&(null==e?void 0:e.dampingRatio)===t.dampingRatio}(a,e),l=r.duration,u=s?null==a?void 0:a.startValue:Number(e.toValue)-t;if(e.velocity=a?(s?null==a?void 0:a.velocity:(null==a?void 0:a.velocity)+r.velocity)||0:r.velocity||0,s)e.zeta=(null==a?void 0:a.zeta)||0,e.omega0=(null==a?void 0:a.omega0)||0,e.omega1=(null==a?void 0:a.omega1)||0;else{if(r.useDuration){const t=s?l-(((null==a?void 0:a.lastTimestamp)||0)-((null==a?void 0:a.startTimestamp)||0)):l;r.duration=t,o=i(u,r,e.velocity)}const{zeta:t,omega0:n,omega1:d}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;if(t.configIsInvalid)return{zeta:0,omega0:0,omega1:0};if(t.useDuration){const{stiffness:n,dampingRatio:a}=t,i=Math.sqrt(n/e);return{zeta:a,omega0:i,omega1:i*Math.sqrt(1-a**2)}}{const{damping:e,mass:n,stiffness:a}=t,i=e/(2*Math.sqrt(a*n)),r=Math.sqrt(a/n);return{zeta:i,omega0:r,omega1:r*Math.sqrt(1-i**2)}}}(o,r);e.zeta=t,e.omega0=n,e.omega1=d}e.lastTimestamp=(null==a?void 0:a.lastTimestamp)||n,e.startTimestamp=s&&(null==a?void 0:a.startTimestamp)||n},toValue:e,velocity:r.velocity||0,current:e,startValue:0,callback:n,lastTimestamp:0,startTimestamp:0,zeta:0,omega0:0,omega1:0,reduceMotion:(0,a.uh)(r.reduceMotion)}}))},49638:(e,t,n)=>{n.d(t,{n:()=>r});var a=n(67177),i=n(34605);n(67294);const r=(0,i.Z)(a.Z)},72510:(e,t,n)=>{n.d(t,{J:()=>s});var a=n(67294),i=n(97604),r=n(10758),o=n(83442);function s(e,t,n){const s=(0,r.y)(null,!0);let l=Object.values(e.__closure??{});var u;(0,o.Wr)()&&(!l.length&&null!==(u=n)&&void 0!==u&&u.length&&(l=n));void 0===n?n=[...Object.values(e.__closure??{}),...Object.values(t.__closure??{}),e.__workletHash,t.__workletHash]:n.push(e.__workletHash,t.__workletHash),(0,a.useEffect)((()=>{const n=(0,i.R)((()=>{const n=e();t(n,s.value),s.value=n}),l,[]);return()=>{(0,i.B)(n)}}),n)}},82334:(e,t,n)=>{n.d(t,{m:()=>d});var a=n(67294),i=n(10758),r=n(7737),o=n(86425),s=n(82747),l=n(22805);const u=n.g._IS_FABRIC?r.b:s.Z;function d(){const e=(0,i.y)(-1),t=(0,i.y)(null),r=(0,a.useRef)();if(!r.current){const a=i=>{var r;i&&(e.value=u(function(e){return n.g._IS_FABRIC&&e.getNativeScrollRef?e.getNativeScrollRef():!n.g._IS_FABRIC&&e.getScrollableNode?e.getScrollableNode():e}(i)),a.current=i,"ios"!==l.Z.OS||n.g._IS_FABRIC||(t.value=(null==i||null===(r=i.viewConfig)||void 0===r?void 0:r.uiViewClassName)||"RCTView"));return e.value};a.current=null;const i=(0,o.wH)({__init:()=>{const n=()=>e.value;return n.viewName=t,n}});(0,o.K_)(a,i),r.current=a}return r.current}},72400:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(67294),i=n(28033),r=n(88548),o=n(24404),s=a.forwardRef(((e,t)=>{var n=e.accessibilityLabel,i=e.color,s=e.disabled,u=e.onPress,d=e.testID,c=e.title;return a.createElement(r.Z,{accessibilityLabel:n,accessibilityRole:"button",disabled:s,focusable:!s,onPress:u,ref:t,style:[l.button,i&&{backgroundColor:i},s&&l.buttonDisabled],testID:d},a.createElement(o.Z,{style:[l.text,s&&l.textDisabled]},c))}));s.displayName="Button";var l=i.Z.create({button:{backgroundColor:"#2196F3",borderRadius:2},text:{color:"#fff",fontWeight:"500",padding:8,textAlign:"center",textTransform:"uppercase"},buttonDisabled:{backgroundColor:"#dfdfdf"},textDisabled:{color:"#a1a1a1"}});const u=s},88548:(e,t,n)=>{n.d(t,{Z:()=>h});var a=n(83117),i=n(80102),r=n(67294),o=n(16528),s=n(94119),l=n(28033),u=n(67177),d=["activeOpacity","delayPressIn","delayPressOut","delayLongPress","disabled","focusable","onLongPress","onPress","onPressIn","onPressOut","rejectResponderTermination","style"];function c(e,t){var n=e.activeOpacity,l=e.delayPressIn,c=e.delayPressOut,p=e.delayLongPress,h=e.disabled,v=e.focusable,f=e.onLongPress,g=e.onPress,k=e.onPressIn,y=e.onPressOut,b=e.rejectResponderTermination,R=e.style,w=(0,i.Z)(e,d),N=(0,r.useRef)(null),x=(0,o.Z)(t,N),T=(0,r.useState)("0s"),_=T[0],C=T[1],A=(0,r.useState)(null),I=A[0],S=A[1],V=(0,r.useCallback)(((e,t)=>{S(e),C(t?t/1e3+"s":"0s")}),[S,C]),P=(0,r.useCallback)((e=>{V(null!=n?n:.2,e)}),[n,V]),D=(0,r.useCallback)((e=>{V(null,e)}),[V]),M=(0,r.useMemo)((()=>({cancelable:!b,disabled:h,delayLongPress:p,delayPressStart:l,delayPressEnd:c,onLongPress:f,onPress:g,onPressStart(e){var t=null!=e.dispatchConfig?"onResponderGrant"===e.dispatchConfig.registrationName:"keydown"===e.type;P(t?0:150),null!=k&&k(e)},onPressEnd(e){D(250),null!=y&&y(e)}})),[p,l,c,h,f,g,k,y,b,P,D]),O=(0,s.Z)(N,M);return r.createElement(u.Z,(0,a.Z)({},w,O,{accessibilityDisabled:h,focusable:!h&&!1!==v,pointerEvents:h?"none":void 0,ref:x,style:[m.root,!h&&m.actionable,R,null!=I&&{opacity:I},{transitionDuration:_}]}))}var m=l.Z.create({root:{transitionProperty:"opacity",transitionDuration:"0.15s",userSelect:"none"},actionable:{cursor:"pointer",touchAction:"manipulation"}}),p=r.memo(r.forwardRef(c));p.displayName="TouchableOpacity";const h=p}}]);